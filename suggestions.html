<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trip Suggestions</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9fb;
      margin: 0;
      padding: 0;
    }

    .header-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px 50px 0px 50px;
      
      
    }

    .header-container h1 {
      margin-top: 15px;
      font-size: 28px;
      font-weight: 600;
      color: #143f69;
      letter-spacing: 0.4px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .main-container {
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 20px;
    }

    .map-container {
      flex: 1;
    }

    iframe {
      width: 100%;
      height: 600px;
      border: none;
      border-radius: 10px;
    }

    .card-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
      max-height: 90vh;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
      padding: 20px;
      transition: 0.3s ease;
      cursor: pointer;
    }

    .card:hover {
      transform: scale(1.015);
      background: #f0f8ff;
    }

    h3 {
      font-size: 20px;
      color: #34495e;
    }

    p {
      font-size: 15px;
      color: #555;
      margin: 6px 0;
    }

    ul {
      padding-left: 20px;
      margin: 5px 0 10px 0;
    }

    li {
      font-size: 14px;
    }

    .btn {
      margin-top: 10px;
      padding: 8px 14px;
      background-color: #2e86de;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn:hover {
      background-color: #1b4f72;
    }

    .error, .empty {
      text-align: center;
      color: #999;
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header-container">
    <h1>Optimized Trip Suggestions</h1>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-container">
    <div class="map-container">
      <iframe id="map-frame" src=""></iframe>
    </div>
    <div class="card-container" id="suggestion-cards"></div>
  </div>

<script>
  function loadSuggestions() {
    const start = localStorage.getItem('start');
    const end = localStorage.getItem('end');
    const duration = localStorage.getItem('duration');
    const cities = JSON.parse(localStorage.getItem('cities') || '[]');

    if (!start || !end || duration <= 0 || cities.length < 1) {
      alert("Please fill in all required fields.");
      return;
    }

    fetch('http://127.0.0.1:5000/optimize', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        start: start || "",
        end: end || "",
        duration: duration || 0,
        cities: cities || []
      })
    })

    // Handle the API(REST API) Response 
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById('suggestion-cards');
      container.innerHTML = '';

      if (!data || data.length === 0) {
        container.innerHTML = "<p class='empty'>No trip suggestions found. Please try again with different inputs.</p>";
        return;
      }

      data.forEach((suggestion, index) => {
        const card = document.createElement('div');
        card.className = 'card';

        const routeData = encodeURIComponent(JSON.stringify(suggestion.route));
       const routeText = (suggestion.route && suggestion.route.length > 0) ? suggestion.route.join(' → ') : "No route available";
const attrText = (suggestion.attractions && suggestion.attractions.length > 0) ? suggestion.attractions.join(', ') : "No additional attractions";
const timeList = (suggestion.spend_time && suggestion.spend_time.length > 0) 
  ? suggestion.spend_time.map((t, i) => `<li>${suggestion.route[i]}: ${t}</li>`).join('') 
  : "<li>No time data</li>";
const nightList = (suggestion.nights && suggestion.nights.length > 0) 
  ? suggestion.nights.map((n, i) => `<li>Day ${i + 1}: ${n}</li>`).join('') 
  : "<li>No nights planned</li>";


        card.innerHTML = `
          <h3>Suggestion ${index + 1}</h3>
          <p><strong>Route:</strong> ${routeText}</p>
          <p><strong>Attractions:</strong> ${attrText}</p>
          <p><strong>Time Spent:</strong></p>
          <ul>${timeList}</ul>
          <p><strong>Night Stays:</strong></p>
          <ul>${nightList}</ul>
          <p><strong>Total Distance:</strong> ${suggestion.total_distance} km</p>
          <p><strong>Estimated Travel Cost:</strong> ₹${suggestion.estimated_cost}</p>
          <p><strong>Estimated Travel Time:</strong> ${suggestion.estimated_time}</p>
          <button class="btn" onclick='goToDetails(${JSON.stringify(suggestion)}, ${index})'>More Details</button>


        `;

        card.addEventListener('click', () => showMap(routeData));
        container.appendChild(card);
      });
    })
    .catch(err => {
      document.getElementById('suggestion-cards').innerHTML = "<p class='error'>Failed to fetch trip suggestions. Please check backend connection.</p>";
      console.error(err);
    });
  }

  function showMap(routeData) {
  try {
    const route = JSON.parse(decodeURIComponent(routeData));
    const origin = encodeURIComponent(route[0]);
    const destination = encodeURIComponent(route[route.length - 1]);
    const waypoints = route.slice(1, -1).map(encodeURIComponent).join('|');

    const apiKey = "Your_API_key"; // <-- Your API key here
    const googleUrl = `https://www.google.com/maps/embed/v1/directions?key=${apiKey}&origin=${origin}&destination=${destination}${waypoints ? `&waypoints=${waypoints}` : ''}`;

    document.getElementById('map-frame').src = googleUrl;
  } catch (e) {
    alert("Failed to load route on map.");
  }
}


  
  function goToDetails(suggestion, index) {
  localStorage.setItem("selectedSuggestion", JSON.stringify(suggestion));
  localStorage.setItem("selectedIndex", index);
  window.location.href = "details.html";
}




  window.onload = loadSuggestions;
</script>

</body>
</html>
